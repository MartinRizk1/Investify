<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investify - Professional Stock Analysis Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff6b35'><path d='M12 2L13.09 8.26L19.4 5.5L16.64 11.36L23 12L16.64 12.64L19.4 18.5L13.09 15.74L12 22L10.91 15.74L4.6 18.5L7.36 12.64L1 12L7.36 11.36L4.6 5.5L10.91 8.26L12 2Z'/></svg>">
    <style>
        :root {
            --primary-bg: #0a0a0a;
            --secondary-bg: #141414;
            --surface-bg: #1a1a1a;
            --surface-elevated: #222222;
            --chart-bg: #0f0f0f;
            --accent-primary: #ff6b35;
            --accent-secondary: #f7931e;
            --accent-success: #00d4aa;
            --accent-danger: #ff4757;
            --accent-warning: #ffa726;
            --accent-gold: #f39c12;
            --text-primary: #ffffff;
            --text-secondary: #b8b8b8;
            --text-muted: #8a8a8a;
            --border-color: #333333;
            --border-muted: #2a2a2a;
            --success-color: #00d4aa;
            --warning-color: #ffa726;
            --danger-color: #ff4757;
            --info-color: #3b82f6;
            --chart-grid: rgba(255, 255, 255, 0.05);
            --chart-text: #b8b8b8;
            --shadow-light: 0 2px 8px rgba(0,0,0,0.4);
            --shadow-medium: 0 8px 24px rgba(0,0,0,0.5);
            --shadow-heavy: 0 16px 48px rgba(0,0,0,0.6);
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --font-mono: 'JetBrains Mono', 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            --gradient-primary: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            --gradient-success: linear-gradient(135deg, var(--accent-success), #00b894);
            --gradient-gold: linear-gradient(135deg, var(--accent-gold), #e67e22);
            --glow-orange: 0 0 20px rgba(255, 107, 53, 0.3);
            --glow-blue: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--surface-bg) 100%);
            padding: 1.25rem 2rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-medium);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius);
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            font-weight: 700;
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }
        
        .logo-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.025em;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .logo-tagline {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: -0.25rem;
        }
        
        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }
        
        .search-form {
            display: flex;
            background: var(--surface-elevated);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 2px solid var(--border-color);
            transition: var(--transition);
            box-shadow: var(--shadow-light);
        }
        
        .search-form:focus-within {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1), var(--shadow-medium);
            transform: translateY(-1px);
        }
        
        .search-input {
            flex: 1;
            padding: 1rem 1.25rem;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1rem;
            outline: none;
            font-family: inherit;
            font-weight: 500;
        }
        
        .search-input::placeholder {
            color: var(--text-muted);
            font-weight: 400;
        }
        
        .search-button {
            padding: 1rem 2.5rem;
            background: var(--gradient-primary);
            border: 1px solid var(--accent-primary);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .search-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.4s ease;
        }
        
        .search-button:hover::before {
            left: 100%;
        }
        
        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--glow-orange);
            border-color: var(--accent-secondary);
        }
        
        .search-button:active {
            transform: translateY(0);
        }
        
        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
            min-height: calc(100vh - 80px);
        }
        
        /* Data Layout */
        .data-layout {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 1.5rem;
            height: calc(100vh - 120px);
        }
        
        /* Company Info Panel */
        .company-panel {
            background: var(--secondary-bg);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-color);
            overflow-y: auto;
            height: 100%;
            box-shadow: var(--shadow-medium);
        }
        
        .company-header {
            padding: 2rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--surface-bg);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            position: relative;
            overflow: hidden;
        }
        
        .company-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }
        
        .company-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            line-height: 1.2;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .company-name i {
            color: var(--accent-primary);
            font-size: 1.25rem;
        }
        
        .company-ticker {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            color: var(--accent-primary);
            font-weight: 700;
            background: rgba(59, 130, 246, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .company-ticker i {
            font-size: 0.75rem;
        }
        
        .price-info {
            margin-top: 1.5rem;
        }
        
        .current-price {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            font-family: var(--font-mono);
            letter-spacing: -0.025em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .current-price i {
            font-size: 1.5rem;
            color: var(--accent-success);
        }
        
        .price-change {
            font-size: 1rem;
            font-weight: 700;
            font-family: var(--font-mono);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .price-change.positive {
            color: var(--success-color);
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
        }
        
        .price-change.negative {
            color: var(--danger-color);
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .price-change i {
            font-size: 0.875rem;
        }
        
        .recommendation-badge {
            margin-top: 1.5rem;
            padding: 1.25rem;
            background: var(--gradient-primary);
            border-radius: var(--border-radius);
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-medium);
        }
        
        .recommendation-badge::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .recommendation-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.75px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .recommendation-label i {
            font-size: 0.875rem;
        }
        
        .recommendation-value {
            font-size: 1.125rem;
            font-weight: 800;
            color: white;
            position: relative;
            z-index: 1;
        }
        
        .company-details {
            padding: 1.5rem;
        }
        
        .metric-section {
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .metric-grid.single-column {
            grid-template-columns: 1fr;
        }
        
        .metric-item {
            background: var(--surface-elevated);
            padding: 1.25rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .metric-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .metric-item:hover::before {
            transform: scaleX(1);
        }
        
        .metric-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
            border-color: var(--accent-primary);
        }
        
        .metric-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }
        
        .metric-label i {
            font-size: 0.875rem;
            color: var(--accent-primary);
        }
        
        .metric-value {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: var(--font-mono);
        }
        
        .company-summary {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--surface-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-muted);
        }
        
        .summary-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }
        
        .summary-text {
            line-height: 1.5;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }
        
        /* Chart Panel */
        .chart-panel {
            background: var(--secondary-bg);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-color);
            overflow-y: auto;
            height: 100%;
            box-shadow: var(--shadow-light);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 1.5rem 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--surface-bg);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }
        
        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .chart-controls {
            display: flex;
            gap: 0.25rem;
            background: var(--surface-elevated);
            padding: 0.25rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        
        .chart-control-btn {
            padding: 0.5rem 1rem;
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        
        .chart-control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,107,53,0.2), transparent);
            transition: left 0.3s ease;
        }
        
        .chart-control-btn:hover::before {
            left: 100%;
        }
        
        .chart-control-btn.active {
            background: var(--gradient-primary);
            color: white;
            border-color: var(--accent-primary);
            box-shadow: var(--glow-orange);
            transform: translateY(-1px);
        }
        
        .chart-control-btn:hover:not(.active) {
            background: var(--surface-elevated);
            color: var(--text-primary);
            border-color: var(--accent-primary);
            transform: translateY(-1px);
        }
        
        .chart-content {
            padding: 1.5rem;
        }
        
        .chart-container {
            background: var(--chart-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            height: 400px;
            position: relative;
            border: 1px solid var(--border-muted);
            margin-bottom: 2rem;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .chart-container.small {
            height: 280px;
            margin-bottom: 0;
        }
        
        .chart-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .chart-stat {
            background: var(--surface-bg);
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-muted);
            text-align: center;
        }
        
        .chart-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .chart-stat-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: var(--font-mono);
        }
        
        .chart-stat-change {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            font-weight: 600;
            font-family: var(--font-mono);
        }
        
        .chart-stat-change.positive {
            color: var(--success-color);
        }
        
        .chart-stat-change.negative {
            color: var(--danger-color);
        }
        
        /* No Data State */
        .no-data-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 4rem 2rem;
            height: 100%;
        }
        
        .no-data-icon {
            font-size: 4rem;
            margin-bottom: 2rem;
            opacity: 0.7;
        }
        
        .no-data-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .no-data-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            line-height: 1.6;
            max-width: 600px;
        }
        
        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--accent-green);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .data-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
                height: auto;
            }
            
            .company-panel,
            .chart-panel {
                height: auto;
                min-height: 400px;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .search-container {
                max-width: 100%;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .metric-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div>
                    <div class="logo-text">Investify</div>
                    <div class="logo-tagline">Professional Analytics</div>
                </div>
            </div>
            
            <div class="search-container">
                <form class="search-form" action="/" method="POST">
                    {{ csrf_token() }}
                    <input 
                        type="text" 
                        name="company" 
                        class="search-input" 
                        placeholder="Search stocks, ETFs, or any publicly traded company..."
                        required
                        autocomplete="off"
                    >
                    <button type="submit" class="search-button">
                        <i class="fas fa-search"></i>
                        Analyze
                    </button>
                </form>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        {% if info %}
        <div class="data-layout">
            <!-- Left Panel: Company Information -->
            <div class="company-panel">
                <div class="company-header">
                    <div class="company-name">
                        <i class="fas fa-building"></i>
                        {{ info.company_name or 'Unknown Company' }}
                    </div>
                    <div class="company-ticker">
                        <i class="fas fa-tag"></i>
                        {{ info.ticker or 'N/A' }}
                    </div>
                    
                    <div class="price-info">
                        <div class="current-price">
                            <i class="fas fa-dollar-sign"></i>
                            {{ info.last_close or 'N/A' }}
                        </div>
                        {% if info.price_change %}
                        <div class="price-change {{ 'positive' if info.price_change.startswith('+') else 'negative' }}">
                            <i class="fas {{ 'fa-arrow-up' if info.price_change.startswith('+') else 'fa-arrow-down' }}"></i>
                            {{ info.price_change }}
                            ({{ info.price_change_pct }})
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="recommendation-badge">
                        <div class="recommendation-label">
                            <i class="fas fa-robot"></i>
                            AI Recommendation
                        </div>
                        <div class="recommendation-value">{{ action or 'ANALYZING...' }}</div>
                    </div>
                </div>

                <div class="company-details">
                    <div class="metric-grid">
                        <div class="metric-item">
                            <div class="metric-label">
                                <i class="fas fa-chart-pie"></i>
                                Market Cap
                            </div>
                            <div class="metric-value">{{ info.market_cap or 'N/A' }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">
                                <i class="fas fa-percentage"></i>
                                P/E Ratio
                            </div>
                            <div class="metric-value">{{ info.pe_ratio or 'N/A' }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">
                                <i class="fas fa-forward"></i>
                                Forward P/E
                            </div>
                            <div class="metric-value">{{ info.forward_pe or 'N/A' }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">
                                <i class="fas fa-coins"></i>
                                Dividend Yield
                            </div>
                            <div class="metric-value">{{ info.dividend_yield or 'N/A' }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">
                                <i class="fas fa-calculator"></i>
                                EPS (TTM)
                            </div>
                            <div class="metric-value">{{ info.eps or 'N/A' }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">
                                <i class="fas fa-money-bill-wave"></i>
                                Revenue (TTM)
                            </div>
                            <div class="metric-value">{{ info.revenue or 'N/A' }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">
                                <i class="fas fa-exchange-alt"></i>
                                Volume
                            </div>
                            <div class="metric-value">{{ info.last_volume or 'N/A' }}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">
                                <i class="fas fa-clock"></i>
                                Last Updated
                            </div>
                            <div class="metric-value">{{ info.last_date or 'N/A' }}</div>
                        </div>
                    </div>

                    {% if info.sector or info.industry %}
                    <div class="metric-grid">
                        {% if info.sector %}
                        <div class="metric-item">
                            <div class="metric-label">
                                <i class="fas fa-industry"></i>
                                Sector
                            </div>
                            <div class="metric-value">{{ info.sector }}</div>
                        </div>
                        {% endif %}
                        {% if info.industry %}
                        <div class="metric-item">
                            <div class="metric-label">
                                <i class="fas fa-cogs"></i>
                                Industry
                            </div>
                            <div class="metric-value">{{ info.industry }}</div>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if info.website %}
                    <div class="metric-item">
                        <div class="metric-label">
                            <i class="fas fa-globe"></i>
                            Website
                        </div>
                        <div class="metric-value">
                            <a href="{{ info.website }}" target="_blank" style="color: var(--accent-primary); text-decoration: none;">
                                {{ info.website }}
                            </a>
                        </div>
                    </div>
                    {% endif %}

                    {% if info.summary %}
                    <div class="company-summary">
                        <div class="summary-title">
                            <i class="fas fa-info-circle"></i>
                            Company Overview
                        </div>
                        <div class="summary-text">{{ info.summary }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Right Panel: Charts and Analysis -->
            <div class="chart-panel">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-chart-line"></i>
                        {{ info.company_name or info.ticker }} Stock Analysis
                    </div>
                    <div class="chart-controls">
                        <button class="chart-control-btn active" data-period="1M">1M</button>
                        <button class="chart-control-btn" data-period="3M">3M</button>
                        <button class="chart-control-btn" data-period="6M">6M</button>
                        <button class="chart-control-btn" data-period="1Y">1Y</button>
                        <button class="chart-control-btn" data-period="5Y">5Y</button>
                    </div>
                </div>
                
                <div class="chart-content">
                    <!-- Quick Stats -->
                    <div class="chart-stats">
                        <div class="chart-stat">
                            <div class="chart-stat-label">
                                <i class="fas fa-play"></i>
                                Open
                            </div>
                            <div class="chart-stat-value">{{ info.open or 'N/A' }}</div>
                        </div>
                        <div class="chart-stat">
                            <div class="chart-stat-label">
                                <i class="fas fa-arrow-up"></i>
                                High
                            </div>
                            <div class="chart-stat-value">{{ info.high or 'N/A' }}</div>
                            {% if info.high_change %}
                            <div class="chart-stat-change {{ 'positive' if info.high_change.startswith('+') else 'negative' }}">
                                {{ info.high_change }}
                            </div>
                            {% endif %}
                        </div>
                        <div class="chart-stat">
                            <div class="chart-stat-label">
                                <i class="fas fa-arrow-down"></i>
                                Low
                            </div>
                            <div class="chart-stat-value">{{ info.low or 'N/A' }}</div>
                            {% if info.low_change %}
                            <div class="chart-stat-change {{ 'positive' if info.low_change.startswith('+') else 'negative' }}">
                                {{ info.low_change }}
                            </div>
                            {% endif %}
                        </div>
                        <div class="chart-stat">
                            <div class="chart-stat-label">
                                <i class="fas fa-calendar-alt"></i>
                                52W Range
                            </div>
                            <div class="chart-stat-value">
                                {% if info.fifty_two_week_low and info.fifty_two_week_high %}
                                {{ info.fifty_two_week_low }} - {{ info.fifty_two_week_high }}
                                {% else %}
                                N/A
                                {% endif %}
                            </div>
                        </div>
                    </div>
                
                    <!-- Main Price Chart -->
                    <div class="chart-container">
                        <canvas id="priceChart"></canvas>
                    </div>
                    
                    <!-- Secondary Charts Grid -->
                    <div class="charts-grid">
                        {% if info.chart_data and info.chart_data.volumes %}
                        <div class="chart-container small">
                            <canvas id="volumeChart"></canvas>
                        </div>
                        {% endif %}
                        
                        <div class="chart-container small">
                            <canvas id="rsiChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart Data for JavaScript -->
        <script type="application/json" id="chartData">{{ info.chart_data|tojson|safe }}</script>
        
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chartDataElement = document.getElementById('chartData');
            if (!chartDataElement) return;
            
            let chartData;
            try {
                chartData = JSON.parse(chartDataElement.textContent);
            } catch (e) {
                console.error('Failed to parse chart data:', e);
                return;
            }
            
            if (!chartData || !chartData.dates || !chartData.closes) {
                console.warn('Invalid chart data structure');
                return;
            }
            
            // Chart.js defaults for Yahoo Finance style
            Chart.defaults.font.family = "'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
            Chart.defaults.font.size = 11;
            Chart.defaults.color = '#8b949e';
            
            // Calculate price change percentage for gradient
            const prices = chartData.closes || [];
            const firstPrice = prices[0];
            const lastPrice = prices[prices.length - 1];
            const isPositive = lastPrice >= firstPrice;
            
            // Yahoo Finance style colors
            const lineColor = isPositive ? '#00d4aa' : '#ff5722';
            const gradientColor = isPositive ? 'rgba(0, 212, 170, 0.1)' : 'rgba(255, 87, 34, 0.1)';
            
            // Main Price Chart with Yahoo Finance styling
            const ctx1 = document.getElementById('priceChart');
            if (ctx1) {
                const gradient = ctx1.getContext('2d').createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, gradientColor);
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                
                priceChart = new Chart(ctx1.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: chartData.dates || [],
                        datasets: [{
                            label: 'Close Price',
                            data: chartData.closes || [],
                            borderColor: lineColor,
                            backgroundColor: gradient,
                            borderWidth: 2.5,
                            fill: true,
                            tension: 0.1,
                            pointRadius: 0,
                            pointHoverRadius: 6,
                            pointHoverBackgroundColor: lineColor,
                            pointHoverBorderColor: '#ffffff',
                            pointHoverBorderWidth: 2,
                            segment: {
                                borderColor: function(ctx) {
                                    const prev = ctx.p0.parsed.y;
                                    const curr = ctx.p1.parsed.y;
                                    return curr >= prev ? '#00d4aa' : '#ff5722';
                                }
                            }
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(13, 17, 23, 0.95)',
                                titleColor: '#f0f6fc',
                                bodyColor: '#f0f6fc',
                                borderColor: lineColor,
                                borderWidth: 1,
                                cornerRadius: 8,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    title: function(context) {
                                        return new Date(context[0].label).toLocaleDateString('en-US', {
                                            weekday: 'short',
                                            year: 'numeric',
                                            month: 'short',
                                            day: 'numeric'
                                        });
                                    },
                                    label: function(context) {
                                        return '$' + context.parsed.y.toFixed(2);
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                ticks: { 
                                    color: '#6e7681',
                                    maxTicksLimit: 6,
                                    font: { size: 10 }
                                },
                                grid: { 
                                    display: false
                                },
                                border: {
                                    color: '#21262d'
                                }
                            },
                            y: {
                                display: true,
                                position: 'right',
                                ticks: { 
                                    color: '#6e7681',
                                    font: { size: 10 },
                                    callback: function(value) {
                                        return '$' + value.toFixed(2);
                                    },
                                    padding: 8
                                },
                                grid: { 
                                    color: 'rgba(139, 148, 158, 0.1)',
                                    lineWidth: 1
                                },
                                border: {
                                    color: '#21262d'
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            // Volume Chart with Yahoo Finance styling
            if (chartData.volumes && chartData.volumes.length > 0) {
                const ctx2 = document.getElementById('volumeChart');
                if (ctx2) {
                    volumeChart = new Chart(ctx2.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: chartData.dates || [],
                            datasets: [{
                                label: 'Volume',
                                data: chartData.volumes || [],
                                backgroundColor: function(context) {
                                    const index = context.dataIndex;
                                    if (index === 0) return 'rgba(139, 148, 158, 0.6)';
                                    
                                    const current = chartData.closes[index];
                                    const previous = chartData.closes[index - 1];
                                    return current >= previous ? 
                                        'rgba(0, 212, 170, 0.6)' : 
                                        'rgba(255, 87, 34, 0.6)';
                                },
                                borderColor: function(context) {
                                    const index = context.dataIndex;
                                    if (index === 0) return '#8b949e';
                                    
                                    const current = chartData.closes[index];
                                    const previous = chartData.closes[index - 1];
                                    return current >= previous ? '#00d4aa' : '#ff5722';
                                },
                                borderWidth: 1,
                                borderRadius: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(13, 17, 23, 0.95)',
                                    titleColor: '#f0f6fc',
                                    bodyColor: '#f0f6fc',
                                    borderColor: '#58a6ff',
                                    borderWidth: 1,
                                    cornerRadius: 8,
                                    padding: 12,
                                    displayColors: false,
                                    callbacks: {
                                        title: function(context) {
                                            return new Date(context[0].label).toLocaleDateString('en-US', {
                                                month: 'short',
                                                day: 'numeric'
                                            });
                                        },
                                        label: function(context) {
                                            const volume = context.parsed.y;
                                            if (volume >= 1000000) {
                                                return (volume / 1000000).toFixed(1) + 'M';
                                            } else if (volume >= 1000) {
                                                return (volume / 1000).toFixed(1) + 'K';
                                            }
                                            return volume.toLocaleString();
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    display: true,
                                    ticks: { 
                                        color: '#6e7681',
                                        maxTicksLimit: 4,
                                        font: { size: 9 }
                                    },
                                    grid: { 
                                        display: false
                                    },
                                    border: {
                                        color: '#21262d'
                                    }
                                },
                                y: {
                                    display: true,
                                    position: 'right',
                                    ticks: { 
                                        color: '#6e7681',
                                        font: { size: 9 },
                                        callback: function(value) {
                                            if (value >= 1000000) {
                                                return (value / 1000000).toFixed(0) + 'M';
                                            } else if (value >= 1000) {
                                                return (value / 1000).toFixed(0) + 'K';
                                            }
                                            return value;
                                        },
                                        padding: 8
                                    },
                                    grid: { 
                                        color: 'rgba(139, 148, 158, 0.1)',
                                        lineWidth: 1
                                    },
                                    border: {
                                        color: '#21262d'
                                    }
                                }
                            },
                            animation: {
                                duration: 500,
                                easing: 'easeInOutQuart'
                            }
                        }
                    });
                }
            }
            
            // Simple RSI Chart (mock data for demonstration)
            const ctx3 = document.getElementById('rsiChart');
            if (ctx3) {
                // Generate mock RSI data based on price movements
                const rsiData = chartData.closes.map((price, index) => {
                    if (index === 0) return 50;
                    const change = (price - chartData.closes[index - 1]) / chartData.closes[index - 1];
                    return Math.max(20, Math.min(80, 50 + (change * 1000)));
                });
                
                rsiChart = new Chart(ctx3.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: chartData.dates || [],
                        datasets: [{
                            label: 'RSI',
                            data: rsiData,
                            borderColor: '#58a6ff',
                            backgroundColor: 'rgba(88, 166, 255, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.2,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(13, 17, 23, 0.95)',
                                titleColor: '#f0f6fc',
                                bodyColor: '#f0f6fc',
                                borderColor: '#58a6ff',
                                borderWidth: 1,
                                cornerRadius: 8,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        return 'RSI: ' + context.parsed.y.toFixed(1);
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                ticks: { 
                                    color: '#6e7681',
                                    maxTicksLimit: 4,
                                    font: { size: 9 }
                                },
                                grid: { display: false },
                                border: { color: '#21262d' }
                            },
                            y: {
                                display: true,
                                position: 'right',
                                min: 20,
                                max: 80,
                                ticks: { 
                                    color: '#6e7681',
                                    font: { size: 9 },
                                    stepSize: 20,
                                    padding: 8
                                },
                                grid: { 
                                    color: 'rgba(139, 148, 158, 0.1)',
                                    lineWidth: 1
                                },
                                border: { color: '#21262d' }
                            }
                        },
                        animation: {
                            duration: 500,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }
            
            // Chart controls functionality
            const controlBtns = document.querySelectorAll('.chart-control-btn');
            let currentTicker = '{{ info.ticker if info else "" }}';
            let priceChart, volumeChart, rsiChart;
            
            controlBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!currentTicker) return;
                    
                    const period = this.dataset.period;
                    
                    // Update active state
                    controlBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show loading state
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    
                    // Fetch new data
                    fetch(`/api/chart/${currentTicker}/${period}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                console.error('API Error:', data.error);
                                this.innerHTML = period;
                                return;
                            }
                            
                            // Update charts with new data
                            updateCharts(data);
                            this.innerHTML = period;
                        })
                        .catch(error => {
                            console.error('Fetch error:', error);
                            this.innerHTML = period;
                        });
                });
            });
            
            function updateCharts(newChartData) {
                // Calculate colors based on price movement
                const prices = newChartData.closes || [];
                const firstPrice = prices[0];
                const lastPrice = prices[prices.length - 1];
                const isPositive = lastPrice >= firstPrice;
                
                const lineColor = isPositive ? '#00d4aa' : '#ff4757';
                const gradientColor = isPositive ? 'rgba(0, 212, 170, 0.1)' : 'rgba(255, 71, 87, 0.1)';
                
                // Update price chart
                if (priceChart) {
                    const ctx = priceChart.canvas.getContext('2d');
                    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                    gradient.addColorStop(0, gradientColor);
                    gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                    
                    priceChart.data.labels = newChartData.dates;
                    priceChart.data.datasets[0].data = newChartData.closes;
                    priceChart.data.datasets[0].borderColor = lineColor;
                    priceChart.data.datasets[0].backgroundColor = gradient;
                    priceChart.data.datasets[0].pointHoverBackgroundColor = lineColor;
                    priceChart.update('none');
                }
                
                // Update volume chart
                if (volumeChart && newChartData.volumes) {
                    volumeChart.data.labels = newChartData.dates;
                    volumeChart.data.datasets[0].data = newChartData.volumes;
                    volumeChart.update('none');
                }
                
                // Update RSI chart with new mock data
                if (rsiChart) {
                    const rsiData = newChartData.closes.map((price, index) => {
                        if (index === 0) return 50;
                        const change = (price - newChartData.closes[index - 1]) / newChartData.closes[index - 1];
                        return Math.max(20, Math.min(80, 50 + (change * 1000)));
                    });
                    
                    rsiChart.data.labels = newChartData.dates;
                    rsiChart.data.datasets[0].data = rsiData;
                    rsiChart.update('none');
                }
            }
        });
        </script>
        
        {% else %}
        <div class="no-data-state">
            <div class="no-data-icon">
                <i class="fas fa-chart-line" style="font-size: 4rem; color: var(--accent-primary); margin-bottom: 1rem;"></i>
            </div>
            <h2 class="no-data-title">Welcome to Investify</h2>
            <p class="no-data-subtitle">
                Your professional stock analysis platform powered by advanced AI and real-time data from Yahoo Finance. 
                Search for any publicly traded company using either the company name or ticker symbol to get 
                comprehensive insights including price history, financial metrics, and investment recommendations.
            </p>
            <p class="no-data-subtitle" style="margin-top: 1.5rem; font-weight: 600; color: var(--accent-primary);">
                <i class="fas fa-lightbulb" style="margin-right: 0.5rem;"></i>
                Try searching: Apple, TSLA, Walgreens, Microsoft, WBA, GOOGL, or any other public company!
            </p>
            <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <div style="background: var(--surface-bg); padding: 0.75rem 1.5rem; border-radius: var(--border-radius); border: 1px solid var(--border-color);">
                    <i class="fas fa-robot" style="color: var(--accent-primary); margin-right: 0.5rem;"></i>
                    AI-Powered Analysis
                </div>
                <div style="background: var(--surface-bg); padding: 0.75rem 1.5rem; border-radius: var(--border-radius); border: 1px solid var(--border-color);">
                    <i class="fas fa-globe" style="color: var(--accent-success); margin-right: 0.5rem;"></i>
                    Global Market Data
                </div>
                <div style="background: var(--surface-bg); padding: 0.75rem 1.5rem; border-radius: var(--border-radius); border: 1px solid var(--border-color);">
                    <i class="fas fa-bolt" style="color: var(--accent-warning); margin-right: 0.5rem;"></i>
                    Real-Time Updates
                </div>
            </div>
        </div>
        {% endif %}
    </main>
</body>
</html>
